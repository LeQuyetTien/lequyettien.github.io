<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8"> <title>Le Quyet Tien - Software Developer</title> <meta http-equip="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="Two-Factor Authentication (2FA) with Google Authenticator & PHP" /> <meta name="keywords" content="Two-Factor Authentication (2FA) with Google Authenticator & PHP, Le Quyet Tien, php" /> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"> <meta content="" property="fb:app_id"> <meta content="Le Quyet Tien" property="og:site_name"> <meta content="Two-Factor Authentication (2FA) with Google Authenticator & PHP" property="og:title"> <meta content="article" property="og:type"> <meta content="Xác thực hai yếu tố đơn giản với Google Authenticator & PHP" property="og:description"> <meta content="https://lequyettien.github.io/php/2020/03/25/two-factor-authentication-with-php/" property="og:url"> <meta content="2020-03-25T08:34:00+00:00" property="article:published_time"> <meta content="https://lequyettien.github.io/about/" property="article:author"> <meta content="php" property="article:section"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@"> <meta name="twitter:title" content="Two-Factor Authentication (2FA) with Google Authenticator & PHP"> <meta content="Le Quyet Tien" property="og:site_name"> <meta name="twitter:url" content="https://lequyettien.github.io/php/2020/03/25/two-factor-authentication-with-php/"> <meta name="twitter:description" content="lequyettien.it@gmail.com"> <link rel="stylesheet" href="/assets/css/main.css" /> <link rel="stylesheet" href="/assets/css/custom-style.css" /> <link rel="stylesheet" href="/assets/bower_components/lightgallery/dist/css/lightgallery.min.css"/> <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css"> <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css"> <link rel="stylesheet" href="/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet"> <!-- Favicon --> <link rel="icon" href="https://lequyettien.github.io/assets/img/favicon.ico" type="image/gif" sizes="16x16"> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous"></script> <!-- <script src="/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script> <script> (function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga'); ga('create', 'UA-158658777-1', 'auto'); ga('send', 'pageview'); </script> </head><body> <div class="container-fluid"><header> <div class="col-lg-12"> <div class="row"> <nav class="navbar navbar-expand-lg fixed-top navbar-dark " id="topNav"> <!-- <a class="navbar-brand" href="#">Le Quyet Tien</a> --> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="/">Le Quyet Tien</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="https://lequyettien.github.io/about">About Me</a> </li> <li class="nav-item"> <a class="nav-link" href="https://lequyettien.github.io/blog">Blog</a> </li> <li class="nav-item"> <a class="nav-link" href="https://lequyettien.github.io/contact">Contact Me</a> </li> </ul> </div> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link" id="search-icon" href="https://lequyettien.github.io/search/"><i class="fa fa-search" aria-hidden="true"></i></a> </li> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() "type="checkbox" name="checkbox" > </li> </ul> </nav> </div> </div> </header><div class="col-lg-12"> <!-- Blog Post Breadcrumbs --><div class="col-lg-12"> <nav aria-label="breadcrumb" role="navigation"> <ol class="breadcrumb"> <li class="breadcrumb-item"> <a href="https://lequyettien.github.io/blog"><i class="fa fa-home" aria-hidden="true"></i></a> </li> <li class="breadcrumb-item active" aria-current="page"><a href="/php/2020/03/25/two-factor-authentication-with-php/">Two-Factor Authentication (2FA) with Google Authenticator & PHP</a></li> </ol> </nav> </div><div class="row" id="blog-post-container"> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <!-- <h1 class="post-title" itemprop="name headline">Two-Factor Authentication (2FA) with Google Authenticator & PHP</h1> --> <h4 class="post-meta">Xác thực hai yếu tố đơn giản với Google Authenticator & PHP</h4> <p class="post-summary">Posted by : <img src="https://lequyettien.github.io/assets/img/profile.png" class="author-profile-img"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">Le Quyet Tien</span> </span> at <time datetime="2020-03-25 08:34:00 +0000" itemprop="datePublished">Mar 25, 2020</time> </p> <span class="disqus-comment-count" data-disqus-identifier="/php/2020/03/25/two-factor-authentication-with-php/"></span> <div class="post-categories"> Category : <a href="/blog/categories/php">php</a> </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="https://lequyettien.github.io/assets/img/posts/google-authentication-php.jpg" alt=""> <br/> <br/> <h1 id="two-factor-authentication-2fa-with-google-authenticator--php">Two-Factor Authentication (2FA) with Google Authenticator &amp; PHP</h1> <p>Gần đây mình có nghiên cứu và triển khai chức năng xác thực hai yếu tố trong một project PHP bằng cách sử dụng Google Authenticator. Vì vậy hôm nay mình muốn chia sẻ nó cho những ai chưa làm được.</p> <h2 id="1-xác-thực-2-yếu-tố-là-gì">1. Xác thực 2 yếu tố là gì?</h2> <p>Xác thực hai yếu tố, hay còn được viết tắt là 2FA (Two-Factor Authentication), là một cách rất an toàn để bảo vệ tài khoản trực tuyến của bạn. Nó hoạt động bằng cách yêu cầu bạn thêm một bước nữa vào quá trình đăng nhập thông thường của bạn để định danh người đăng nhập có phải là bạn hay không, hay là một ai khác. Qúa trình 2FA dựa trên 2 yếu tố cơ bản, yếu tố thứ nhất được hiểu đơn giản là những gì bạn biết (username và password của bạn) và yếu tố thứ hai gắn liền với những gì bạn có (điện thoại di động của bạn).</p> <h2 id="2-google-authenticator-hoạt-động-như-thế-nào">2. Google Authenticator hoạt động như thế nào?</h2> <p>Google Authenticator là một ứng dụng miễn phí cho smartphone. Nó hoạt động như sau:</p> <ol> <li> <p>Khi bật 2FA, ứng dụng mà bạn đang bảo mật sẽ tạo ra một mã QR, người dùng scan nó bằng Google Authenticator để thêm profile vào ứng dụng.</p> </li> <li> <p>Sau khi đăng nhập bằng username và password, người dùng sẽ sử dụng mã xác thực từ Google Authenticator để điền vào bước xác thực thứ 2.</p> </li> </ol> <p>Mã xác thực sẽ được tạo mới sau mỗi 30 giây.</p> <h2 id="3-cài-đặt-google-authenticator">3. Cài đặt Google Authenticator</h2> <p>Cài đặt ứng dụng Google Authenticator trên điện thoại:</p> <ul> <li> <p><a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2">Android</a></p> </li> <li> <p><a href="https://apps.apple.com/us/app/google-authenticator/id388497605">iOS</a></p> </li> </ul> <h2 id="4-triển-khai-google-authenticator-trên-website-sử-dụng-php">4. Triển khai Google Authenticator trên website sử dụng PHP</h2> <h3 id="41-cài-đặt-google-authenticator-php-class">4.1. Cài đặt Google Authenticator PHP class</h3> <p>Chúng ta sẽ sử dụng thư viện nguồn mở <a href="https://github.com/PHPGangsta/GoogleAuthenticator">PHPGangsta/GoogleAuthenticator</a> để:</p> <ul> <li> <p>Tạo mã QR cho người dùng scan khi họ bật 2FA.</p> </li> <li> <p>Xác minh mã người dùng nhập khi đăng nhập.</p> </li> </ul> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>composer require phpgangsta/googleauthenticator:dev-master
</code></pre></div></div> <h3 id="42-tạo-mã-qr">4.2. Tạo mã QR</h3> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">require_once</span> <span class="s1">'PHPGangsta/GoogleAuthenticator.php'</span><span class="p">;</span>

<span class="nv">$ga</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PHPGangsta_GoogleAuthenticator</span><span class="p">();</span>

<span class="nv">$secret</span> <span class="o">=</span> <span class="nv">$ga</span><span class="o">-&gt;</span><span class="na">createSecret</span><span class="p">();</span>
<span class="c1">// Lưu biến này vào database để verify sau này</span>

<span class="nv">$qrCodeUrl</span> <span class="o">=</span> <span class="nv">$ga</span><span class="o">-&gt;</span><span class="na">getQRCodeGoogleUrl</span><span class="p">(</span><span class="s1">'Blog'</span><span class="p">,</span> <span class="nv">$secret</span><span class="p">);</span>  
<span class="c1">// Trả về mã QR này để người dùng scan bằng ứng dụng Google Authenticator trên điện thoại</span>
<span class="k">echo</span> <span class="s1">'&lt;img src="'</span><span class="o">.</span><span class="nv">$qrCodeUrl</span><span class="o">.</span><span class="s1">'"/&gt;'</span><span class="p">;</span>
</code></pre></div></div> <h3 id="43-xác-minh-mã">4.3. Xác minh mã</h3> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">require_once</span> <span class="s1">'PHPGangsta/GoogleAuthenticator.php'</span><span class="p">;</span>

<span class="nv">$ga</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PHPGangsta_GoogleAuthenticator</span><span class="p">();</span>
<span class="c1">// TODO: lấy giá trị biến $secret của người dùng đã đăng nhập từ database</span>
<span class="nv">$check_this_code</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'code'</span><span class="p">];</span>

<span class="nv">$checkResult</span> <span class="o">=</span> <span class="nv">$ga</span><span class="o">-&gt;</span><span class="na">verifyCode</span><span class="p">(</span><span class="nv">$secret</span><span class="p">,</span> <span class="nv">$check_this_code</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$checkResult</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">echo</span> <span class="s1">'Success!'</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="k">echo</span> <span class="s1">'Invalid login'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> </div> <div id="disqus_thread"></div> </article> <script> var disqus_config = function () { this.page.url = "https://lequyettien.github.io/php/2020/03/25/two-factor-authentication-with-php/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/php/2020/03/25/two-factor-authentication-with-php"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://LeQuyetTien.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <!-- End of row--> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header"> About </div> <div class="card-body"> <!-- Your Bio --> <p class="author_bio"> Hello, My Name is Le Quyet Tien. I love to Code and Design.</p><!-- Place this tag where you want the button to render. --> <a class="github-button" href="https://github.com/sujaykundu777/devlopr-jekyll" data-size="large" data-show-count="true" aria-label="Star sujaykundu777/devlopr-jekyll on GitHub">Star</a></div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories </div> <div class="card-body text-dark"> <div id="#ionic"></div> <li class="tag-head"> <a href="/blog/categories/ionic">ionic</a> </li> <a name="ionic"></a> <div id="#php"></div> <li class="tag-head"> <a href="/blog/categories/php">php</a> </li> <a name="php"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links </div> <div class="card-body text-dark"> <li > <a href="https://lequyettien.github.io/about">About Me</a> </li> <li > <a href="https://lequyettien.github.io/blog">Blog</a> </li> <li > <a href="https://lequyettien.github.io/contact">Contact Me</a> </li> </div> </div> </div> </div> </div> </div> <footer> <p>Le Quyet Tien - Software Developer</p> </footer> </div> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> <script src="/assets/js/mode-switcher.js"></script> </body> </html>
